name: 🌌 Build Stellae Linux ISO

# Quando rodar
on:
  push:
    branches: [ main ]
  workflow_dispatch:  # Permite rodar manualmente no GitHub

# Definição do trabalho
jobs:
  build-stellae:
    name: 🔧 Construir ISO
    runs-on: ubuntu-latest
    timeout-minutes: 90

    steps:
    # 1. Clonar o repositório
    - name: 🔁 Clonar repositório
      uses: actions/checkout@v4

    # 2. Tornar o script de build executável
    - name: 📂 Tornar build-stellae.sh executável
      run: |
        chmod +x build/build-stellae.sh

    # 3. Instalar dependências necessárias
    - name: 🧰 Instalar live-build e ferramentas
      run: |
        sudo apt-get update
        sudo apt-get install -y \
          live-build \
          squashfs-tools \
          syslinux \
          isolinux \
          xorriso \
          dosfstools \
          mtools \
          --no-install-recommends

    # 4. Executar o script de construção
    - name: 🏗️ Executar construção da Stellae
      run: |
        cd build
        sudo ./build-stellae.sh

    # 5. Enviar a ISO como artefato
    - name: 📦 Enviar ISO para download
      uses: actions/upload-artifact@v4
      with:
        path: stellae-iso/binary.iso
        name: stellae-linux-$(date '+%Y%m%d-%H%M').iso
        retention-days: 7
        if-no-files-found: error
