name: ğŸŒŒ Build Stellae Linux ISO

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    timeout-minutes: 90

    steps:
    - name: ğŸ›ï¸ Iniciar
      run: |
        echo "ğŸš€ Iniciando construÃ§Ã£o da Stellae Linux"
        df -h /

    - name: ğŸ” Clonar repositÃ³rio
      uses: actions/checkout@v4

    - name: ğŸ§° Instalar dependÃªncias
      run: |
        sudo apt update -y
        sudo apt install -y \
          debootstrap \
          grub-pc-bin \
          grub-efi-amd64-bin \
          xorriso \
          dosfstools \
          mtools \
          gdisk \
          --no-install-recommends

    - name: ğŸ“‚ Verificar se hÃ¡ script de build
      run: |
        if [ ! -f "build/build-stellae.sh" ]; then
          echo "âŒ Erro: build/build-stellae.sh nÃ£o encontrado!"
          exit 1
        fi
        chmod +x build/build-stellae.sh

    - name: ğŸ—ï¸ Executar construÃ§Ã£o
      run: |
        cd build
        sudo ./build-stellae.sh

    - name: ğŸ“¦ Enviar ISO como artefato
      if: success()
      uses: actions/upload-artifact@v4
      with:
        path: stellae-iso/binary.iso
        name: stellae-linux-$(date '+%Y%m%d-%H%M').iso
        retention-days: 7
